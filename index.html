<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>The Rolodex From Hades [Demo Version]</title>
<style>
  :root {
    --bg: #2c0f1a;
    --card-bg: #111;
    --border: #444;
    --accent: #fff;
    --accent-hover: #d9c1cf;
    --text: #f5f5f5;
    --muted: #a78b9c;
    --radius: 14px;

    --result-font: 1.6rem;
    --result-pad: 32px;
    --result-minh: 6.2em;
    --result-maxw: 760px;

    --filters-maxw: 1200px; /* wider panel for desktop */
  }

  html, body { height: 100%; -webkit-text-size-adjust: 100%; text-size-adjust: 100%; }
  body {
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto,
                 "Segoe UI Symbol", "Noto Music", "Apple Symbols", sans-serif;
    background: var(--bg); color: var(--text); padding: 24px;
  }
  h1 { font-size:1.6rem; font-weight:600; margin:0 0 8px; }
  h2 { font-size:1rem; font-weight:400; margin:0 0 16px; color:var(--muted); }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  button {
    padding:12px 20px; border-radius:var(--radius); border:1px solid var(--accent);
    background:var(--card-bg); color:var(--text); cursor:pointer; font-size:1.1rem;
    transition:background .2s;
  }
  button:hover { background:var(--border); }
  button.primary { background:var(--accent); color:#000; font-weight:700; }
  button.primary:hover { background:var(--accent-hover); color:#111; }

  .result {
    margin-top:20px; padding: var(--result-pad); font-size: var(--result-font); font-weight:600;
    background:var(--card-bg); border:2px solid var(--accent); border-radius:var(--radius);
    min-height: var(--result-minh); width: min(100%, var(--result-maxw)); margin-inline: auto; box-sizing: border-box;
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    text-align:center; line-height:1.4; box-shadow:0 0 12px rgba(255,255,255,.15);
  }
  .result .line { display:block; width:100%; text-align:center; line-height:1.35; }
  .result .meta  { color: #888; font-weight: normal; font-size: 0.9em; }
  .result .label { color: #bbb; font-weight: normal; }

  .filters {
    margin-top: 12px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 14px;
    width: min(100%, var(--filters-maxw));
    margin-inline: auto;
    box-sizing: border-box;
  }
  .filters.hidden { display: none; }

  .filters-top {
    display: flex; gap: 8px; align-items: center; justify-content: flex-end;
    margin-bottom: 8px;
  }

  .filters-inner {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
  }

  .filters-col {
    display: flex;
    flex-direction: column;
    gap: 8px;
    box-sizing: border-box;
    min-width: 0; /* prevent overflow into neighboring columns */
  }
  .filters-col header { display: flex; align-items: center; justify-content: space-between; }
  .filters-col h3 { margin: 0; font-size: 1rem; font-weight: 600; }

  /* Tuned widths */
  .filters-col.strings { flex: 0 0 140px; }
  .filters-col.notes   { flex: 0 0 180px; }
  .filters-col.sizes   { flex: 0 0 140px; }
  .filters-col.scales  { flex: 2 1 640px; min-width: 520px; }

  .mini-btns button { font-size: .8rem; padding: 4px 10px; border-radius: 999px;
    border: 1px solid var(--border); background: #1b1b1b; color: var(--text); }

  .checklist { display: grid; grid-template-columns: 1fr; gap: 6px; }
  .checklist label {
    display: flex; align-items: center; gap: 8px; padding: 6px 8px;
    border: 1px solid var(--border); border-radius: 8px; background: #161616; cursor: pointer;
    min-width: 0; overflow: hidden;
  }
  .checklist input { transform: scale(1.1); }
  .checklist label > span:first-of-type { flex: 1; min-width: 0; white-space: normal; }
  .checklist .muted { color: var(--muted); font-size: .85rem; margin-left: auto; white-space: nowrap; }

  .pills { display: grid; grid-template-columns: 1fr; gap: 8px; }
  .pill {
    display: inline-flex; justify-content: center; align-items: center; gap: 6px;
    border: 1px solid var(--border); background: #161616; color: var(--text);
    border-radius: 999px; padding: 8px 12px; cursor: pointer; user-select: none;
    font-size: 0.95rem; width: 100%; box-sizing: border-box;
  }
  .pill input { display: none; }
  .pill.active { border-color: var(--accent); box-shadow: 0 0 0 1px var(--accent) inset; }

  @media (max-width: 1100px) {
    .filters-col.scales { min-width: min(100%, 520px); flex: 1 1 520px; }
  }
  @media (max-width: 600px) {
    .filters-col.strings,
    .filters-col.notes,
    .filters-col.sizes,
    .filters-col.scales { flex: 1 1 100%; min-width: 0; }
  }
</style>

<h1>The Rolodex From Hades [Demo Version]</h1>
<h2>A systematic and gamified approach to learning to improvise with intervallic patterns inspired by musical visionaries, including Nicolas Slonimsky, Allan Holdsworth and Wayne Krantz.</h2>

<div class="row">
  <button id="pickBtn" class="primary"><b>Generate</b></button>
</div>

<div id="out" class="result">—</div>

<div class="row" style="margin-top:12px">
  <button id="filtersBtn">Filters</button>
</div>

<!-- Filters panel -->
<div id="filters" class="filters hidden">
  <div class="filters-top">
    <button id="resetBtn" type="button" title="Reset all filters to default">Reset All</button>
  </div>
  <div class="filters-inner">
    <div class="filters-col strings">
      <header><h3>Strings</h3><div class="mini-btns"><button class="group-toggle" data-group="strings">None</button></div></header>
      <div id="stringsList" class="checklist"></div>
    </div>
    <div class="filters-col notes">
      <header><h3>Notes</h3><div class="mini-btns"><button class="group-toggle" data-group="notes">None</button></div></header>
      <div id="notesList" class="checklist"></div>
    </div>
    <div class="filters-col sizes">
      <header><h3>Sizes</h3><div class="mini-btns"><button class="group-toggle" data-group="sizes">None</button></div></header>
      <div id="sizesList" class="pills"></div>
    </div>
    <div class="filters-col scales">
      <header><h3>Scales</h3><div class="mini-btns"><button class="group-toggle" data-group="scales">None</button></div></header>
      <div id="scalesList" class="checklist"></div>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);

/* --- Embedded Scales (ALL 22) --- */
const EMBEDDED_SCALES = [
  {"id":"393","size":"5-note","name":"Pentatonic Major","intervals":"1-2-3-5-6"},
  {"id":"849","size":"6-note","name":"Messiaen Mode 1 (Whole Tone)","intervals":"1-2-3-#4-#5-b7"},
  {"id":"936","size":"6-note","name":"Blues","intervals":"1-b3-4-b5-nat5-b7"},
  {"id":"1324","size":"7-note","name":"Harmonic Minor","intervals":"1-2-b3-4-5-b6-7"},
  {"id":"1326","size":"7-note","name":"Melodic Minor","intervals":"1-2-b3-4-5-6-7"},
  {"id":"1334","size":"7-note","name":"Hungarian Minor","intervals":"1-2-b3-#4-5-b6-7"},
  {"id":"1359","size":"7-note","name":"Harmonic Major","intervals":"1-2-3-4-5-b6-7"},
  {"id":"1361","size":"7-note","name":"Major","intervals":"1-2-3-4-5-6-7"},
  {"id":"1594","size":"8-note","name":"Messiaen Mode 4","intervals":"1-b2-2-nat4-#4-nat5-#5-7"},
  {"id":"1636","size":"8-note","name":"Messiaen Mode 2 (Diminished)","intervals":"1-b2-b3-nat3-#4-5-6-b7"},
  {"id":"1736","size":"8-note","name":"Jazz Minor (add #4)","intervals":"1-2-b3-nat4-#4-5-6-7"},
  {"id":"1743","size":"8-note","name":"Jazz Minor (add b6)","intervals":"1-2-b3-4-nat5-#5-6-7"},
  {"id":"1745","size":"8-note","name":"Jazz Minor (add b7)","intervals":"1-2-b3-4-5-6-b7-nat7"},
  {"id":"1761","size":"8-note","name":"Messiaen Mode 6","intervals":"1-2-3-nat4-#4-#5-b7-nat7"},
  {"id":"1764","size":"8-note","name":"Jazz Major (add b6)","intervals":"1-2-3-4-nat5-#5-6-7"},
  {"id":"1766","size":"8-note","name":"Jazz Dominant (add nat7)","intervals":"1-2-3-4-5-6-b7-nat7"},
  {"id":"1948","size":"9-note","name":"Jazz Major (add b3, b6)","intervals":"1-2-b3-nat3-4-nat5-#5-6-7"},
  {"id":"1950","size":"9-note","name":"Jazz Dominant (add b3, nat7)","intervals":"1-2-b3-nat3-4-5-6-b7-nat7"},
  {"id":"1954","size":"9-note","name":"Messiaen Mode 3","intervals":"1-2-b3-nat3-#4-nat5-#5-b7-nat7"},
  {"id":"1961","size":"9-note","name":"Jazz Minor (add b5, b7)","intervals":"1-2-b3-nat4-#4-5-6-b7-nat7"},
  {"id":"2004","size":"10-note","name":"Messiaen Mode 7","intervals":"1-b2-nat2-b3-nat4-#4-5-#5-6-7"},
  {"id":"2048","size":"12-note","name":"Chromatic","intervals":"1-b2-nat2-b3-nat3-nat4-#4-nat5-#5-6-b7-nat7"}
];

/* Pools */
const BASE_STRINGS = ["6","5","4","3","2","1"];
const BASE_NOTES   = ["A","A#/Bb","B","C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab"];

/* Sizes derived & numerically sorted by leading number */
const BASE_SIZES = (() => {
  const set = new Set(EMBEDDED_SCALES.map(s => s.size));
  return [...set].sort((a,b) => {
    const na = parseInt((a.match(/^(\d+)/)||[])[1]||1e9,10);
    const nb = parseInt((b.match(/^(\d+)/)||[])[1]||1e9,10);
    if (na !== nb) return na - nb;
    return a.localeCompare(b);
  });
})();

/* Musical accidentals conversion */
function toMusical(str){
  if (!str) return str;
  return String(str)
    .replace(/([A-Ga-g])##/g, '$1𝄪').replace(/([A-Ga-g])bb/g, '$1𝄫')
    .replace(/([A-Ga-g])#/g,  '$1♯').replace(/([A-Ga-g])b/g,  '$1♭')
    .replace(/##(?=\d)/g, '𝄪').replace(/bb(?=\d)/g, '𝄫')
    .replace(/#(?=\d)/g,  '♯').replace(/b(?=\d)/g,  '♭')
    .replace(/\bnat\s*(\d)/gi, '♮$1');
}

/* Selection state */
let selected = {
  strings: new Set(BASE_STRINGS),
  notes:   new Set(BASE_NOTES),
  sizes:   new Set(BASE_SIZES),
  scales:  new Set(EMBEDDED_SCALES.map(s=>s.id))
};

/* Helpers for All/None */
function groupTotals(group){
  if (group === 'strings') return BASE_STRINGS.length;
  if (group === 'notes')   return BASE_NOTES.length;
  if (group === 'sizes')   return BASE_SIZES.length;
  if (group === 'scales')  return EMBEDDED_SCALES.length;
  return 0;
}
function isAllSelected(group){
  const set = selected[group];
  return set && set.size === groupTotals(group);
}
function updateGroupToggleLabels(){
  document.querySelectorAll('.group-toggle').forEach(btn=>{
    const g = btn.dataset.group;
    btn.textContent = isAllSelected(g) ? 'None' : 'All';
  });
}

/* Render filter columns */
function renderFilters(){
  $("stringsList").innerHTML = BASE_STRINGS
    .map(v => `<label><input type="checkbox" value="${v}" ${selected.strings.has(v)?"checked":""}><span>${v}</span></label>`)
    .join("");

  $("notesList").innerHTML = BASE_NOTES
    .map(v => `<label><input type="checkbox" value="${v}" ${selected.notes.has(v)?"checked":""}><span>${toMusical(v)}</span></label>`)
    .join("");

  $("sizesList").innerHTML = BASE_SIZES
    .map(v => `<label class="pill ${selected.sizes.has(v)?"active":""}"><input type="checkbox" value="${v}" ${selected.sizes.has(v)?"checked":""}><span>${v}</span></label>`)
    .join("");

  $("scalesList").innerHTML = EMBEDDED_SCALES
    .map(s => `<label><input type="checkbox" value="${s.id}" ${selected.scales.has(s.id)?"checked":""}><span>${toMusical(s.name)}</span><span class="muted">ID: ${s.id}</span></label>`)
    .join("");

  updateGroupToggleLabels();
}

/* Generate a pick */
function pick(){
  const stringsPool = BASE_STRINGS.filter(s => selected.strings.has(s));
  const notesPool   = BASE_NOTES.filter(n => selected.notes.has(n));
  const scalesPool  = EMBEDDED_SCALES.filter(s => selected.scales.has(s.id) && selected.sizes.has(s.size));

  if (!stringsPool.length && !notesPool.length && !scalesPool.length) {
    $("out").innerHTML = '<div class="line">No items selected.</div>';
    return;
  }

  const stringVal = stringsPool.length ? stringsPool[Math.floor(Math.random()*stringsPool.length)] : null;
  const noteVal   = notesPool.length   ? notesPool[Math.floor(Math.random()*notesPool.length)]     : null;
  const s         = scalesPool.length  ? scalesPool[Math.floor(Math.random()*scalesPool.length)]   : null;

  const noteStr = toMusical(noteVal);
  const nameStr = s ? toMusical(s.name) : "—";
  const ivlStr  = s ? toMusical(s.intervals) : "—";
  const metaStr = s ? `(ID: ${s.id}, Size: ${s.size})` : "";

  $("out").innerHTML = `
    <div class="line"><span class="label">String:</span> ${stringVal ?? "—"} · <span class="label">Note:</span> ${noteStr ?? "—"}</div>
    <div class="line"><span class="label">Scale:</span> ${nameStr} ${s ? `<span class="meta">${metaStr}</span>` : ""}</div>
    <div class="line"><span class="label">Intervals:</span> ${ivlStr}</div>
  `;
}

/* Event wiring */
$("pickBtn").addEventListener("click", pick);
$("filtersBtn").addEventListener("click", () => $("filters").classList.toggle("hidden"));
$("resetBtn").addEventListener("click", () => {
  selected = {
    strings: new Set(BASE_STRINGS),
    notes:   new Set(BASE_NOTES),
    sizes:   new Set(BASE_SIZES),
    scales:  new Set(EMBEDDED_SCALES.map(s=>s.id))
  };
  renderFilters();
});

/* Delegated change handlers */
document.addEventListener("change", (e) => {
  const t = e.target;
  if (!(t instanceof HTMLInputElement)) return;

  if (t.closest("#stringsList")) {
    t.checked ? selected.strings.add(t.value) : selected.strings.delete(t.value);
    updateGroupToggleLabels();
  }
  if (t.closest("#notesList")) {
    t.checked ? selected.notes.add(t.value) : selected.notes.delete(t.value);
    updateGroupToggleLabels();
  }
  if (t.closest("#sizesList")) {
    const pill = t.closest(".pill");
    t.checked ? (selected.sizes.add(t.value), pill.classList.add("active"))
              : (selected.sizes.delete(t.value), pill.classList.remove("active"));
    updateGroupToggleLabels();
  }
  if (t.closest("#scalesList")) {
    t.checked ? selected.scales.add(t.value) : selected.scales.delete(t.value);
    updateGroupToggleLabels();
  }
});

/* All/None per group (toggle based on current state) */
document.querySelectorAll(".group-toggle").forEach(btn => {
  btn.addEventListener("click", () => {
    const g = btn.dataset.group;
    const set = selected[g];
    if (!set) return;

    const makeAll = !isAllSelected(g); // if not all selected -> select all
    set.clear();
    if (makeAll) {
      if (g === 'strings') BASE_STRINGS.forEach(v => set.add(v));
      if (g === 'notes')   BASE_NOTES.forEach(v => set.add(v));
      if (g === 'sizes')   BASE_SIZES.forEach(v => set.add(v));
      if (g === 'scales')  EMBEDDED_SCALES.forEach(s => set.add(s.id));
    }
    renderFilters();
  });
});

/* Initial render */
renderFilters();
</script>
