<!doctype html>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>The Rolodex From Hades [Demo Version]</title>
<style>
  :root {
    --bg: #2c0f1a;
    --card-bg: #111;
    --border: #444;
    --accent: #fff;
    --accent-hover: #d9c1cf;
    --text: #f5f5f5;
    --muted: #a78b9c;
    --radius: 14px;

    /* Desktop defaults */
    --result-font: 1.6rem;
    --result-pad: 32px;
    --result-minh: 6.2em;
    --result-maxw: 760px; /* keep nice width on large screens */
  }

  html, body {
    height: 100%;
    -webkit-text-size-adjust: 100%;
    text-size-adjust: 100%;
  }
  body {
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto,
                 "Segoe UI Symbol", "Noto Music", "Apple Symbols", sans-serif;
    background: var(--bg); color: var(--text); padding: 24px;
  }
  h1 { font-size:1.6rem; font-weight:600; margin:0 0 8px; }
  h2 { font-size:1rem; font-weight:400; margin:0 0 16px; color:var(--muted); }
  .row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

  /* Bigger, thumb-friendly button */
  button {
    padding:12px 20px;
    border-radius:var(--radius);
    border:1px solid var(--accent);
    background:var(--card-bg);
    color:var(--text);
    cursor:pointer;
    font-size:1.1rem;
    transition:background .2s;
  }
  button:hover { background:var(--border); }
  button.primary { background:var(--accent); color:#000; font-weight:700; }
  button.primary:hover { background:var(--accent-hover); color:#111; }

  /* Result area (with max width & centered) */
  .result {
    margin-top:20px;
    padding: var(--result-pad);
    font-size: var(--result-font);
    font-weight:600;
    background:var(--card-bg);
    border:2px solid var(--accent);
    border-radius:var(--radius);
    min-height: var(--result-minh);
    width: min(100%, var(--result-maxw));
    margin-inline: auto;
    box-sizing: border-box;

    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    text-align:center;
    line-height:1.4;
    box-shadow:0 0 12px rgba(255,255,255,.15);
  }

  /* Generic printed row */
  .result .line {
    display:block;
    width:100%;
    text-align:center;
    line-height:1.35;
  }

  /* Single-line that auto-shrinks to fit (String · Note) */
  .result .line.fit {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: clip;
  }

  /* Single-line with ellipsis (desktop/tablet) */
  .result .line.ellip {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .result .meta {
    color: #888;
    font-weight: normal;
    font-size: 0.9em;
  }
  .result .label {
    color: #bbb;
    font-weight: normal;
  }

  /* -----------------------------
     PHONE — PORTRAIT
     Make things a bit smaller and clamp long lines to 2 rows.
     ----------------------------- */
  @media (max-width: 600px) and (orientation: portrait) {
    :root {
      --result-font: clamp(1.2rem, 4.5vw, 1.5rem);
      --result-pad: 22px;
      --result-minh: 6.0em;
    }
    body { padding: 18px; }
    h1 { font-size: 1.45rem; }
    h2 { font-size: .95rem; }

    /* Turn ellipsis into 2-line clamp for readability */
    .result .line.ellip {
      white-space: normal;
      overflow: hidden;
      display: -webkit-box;
      -webkit-box-orient: vertical;
      -webkit-line-clamp: 2;   /* <-- two lines max */
      line-clamp: 2;
    }

    /* Optional: on very tight screens, hide labels to gain space */
    @media (max-width: 380px) {
      .result .label { display:none; }
    }
  }

  /* -----------------------------
     PHONE — LANDSCAPE (short height)
     Make card & type scale with viewport height so it never pushes the edges.
     ----------------------------- */
  @media (max-height: 420px) and (orientation: landscape) {
    :root {
      /* font scales with safe viewport height; keeps card inside */
      --result-font: clamp(1rem, 4.2svh, 1.25rem);
      --result-pad: clamp(12px, 3.5svh, 18px);
      --result-minh: 5.6em;
      --result-maxw: 92svw; /* avoid touching edges */
    }
    body { padding: min(16px, 3svh); }
    h1 { font-size: clamp(1.1rem, 3.8svh, 1.3rem); }
    h2 { font-size: clamp(.85rem, 3.2svh, .95rem); }
    .result { box-shadow:0 0 8px rgba(255,255,255,.12); }
  }
</style>

<h1>The Rolodex From Hades [Demo Version]</h1>
<h2>A systematic and gamified approach to learning to improvise with intervallic patterns inspired by musical visionaries, including Nicolas Slonimsky, Allan Holdsworth and Wayne Krantz.</h2>

<div class="row">
  <button id="pickBtn" class="primary"><b>Generate</b></button>
</div>

<div id="out" class="result">—</div>

<script>
const $ = id => document.getElementById(id);

/* --- Embedded Scales (latest list) --- */
const EMBEDDED_SCALES = [
  {"id":"393","size":"5-note","name":"Pentatonic Major","intervals":"1-2-3-5-6"},
  {"id":"849","size":"6-note","name":"Messiaen Mode 1 (Whole Tone)","intervals":"1-2-3-#4-#5-b7"},
  {"id":"936","size":"6-note","name":"Blues","intervals":"1-b3-4-b5-nat5-b7"},
  {"id":"1324","size":"7-note","name":"Harmonic Minor","intervals":"1-2-b3-4-5-b6-7"},
  {"id":"1326","size":"7-note","name":"Melodic Minor","intervals":"1-2-b3-4-5-6-7"},
  {"id":"1334","size":"7-note","name":"Hungarian Minor","intervals":"1-2-b3-#4-5-b6-7"},
  {"id":"1359","size":"7-note","name":"Harmonic Major","intervals":"1-2-3-4-5-b6-7"},
  {"id":"1361","size":"7-note","name":"Major","intervals":"1-2-3-4-5-6-7"},
  {"id":"1594","size":"8-note","name":"Messiaen Mode 4","intervals":"1-b2-2-nat4-#4-nat5-#5-7"},
  {"id":"1636","size":"8-note","name":"Messiaen Mode 2 (Diminished)","intervals":"1-b2-b3-nat3-#4-5-6-b7"},
  {"id":"1736","size":"8-note","name":"Jazz Minor (add #4)","intervals":"1-2-b3-nat4-#4-5-6-7"},
  {"id":"1743","size":"8-note","name":"Jazz Minor (add b6)","intervals":"1-2-b3-4-nat5-#5-6-7"},
  {"id":"1745","size":"8-note","name":"Jazz Minor (add b7)","intervals":"1-2-b3-4-5-6-b7-nat7"},
  {"id":"1761","size":"8-note","name":"Messiaen Mode 6","intervals":"1-2-3-nat4-#4-#5-b7-nat7"},
  {"id":"1764","size":"8-note","name":"Jazz Major (add b6)","intervals":"1-2-3-4-nat5-#5-6-7"},
  {"id":"1766","size":"8-note","name":"Jazz Dominant (add nat7)","intervals":"1-2-3-4-5-6-b7-nat7"},
  {"id":"1948","size":"9-note","name":"Jazz Major (add b3, b6)","intervals":"1-2-b3-nat3-4-nat5-#5-6-7"},
  {"id":"1950","size":"9-note","name":"Jazz Dominant (add b3, nat7)","intervals":"1-2-b3-nat3-4-5-6-b7-nat7"},
  {"id":"1954","size":"9-note","name":"Messiaen Mode 3","intervals":"1-2-b3-nat3-#4-nat5-#5-b7-nat7"},
  {"id":"1961","size":"9-note","name":"Jazz Minor (add b5, b7)","intervals":"1-2-b3-nat4-#4-5-6-b7-nat7"},
  {"id":"2004","size":"10-note","name":"Messiaen Mode 7","intervals":"1-b2-nat2-b3-nat4-#4-5-#5-6-7"},
  {"id":"2048","size":"12-note","name":"Chromatic","intervals":"1-b2-nat2-b3-nat3-nat4-#4-nat5-#5-6-b7-nat7"}
];

/* --- Accidental converter: ASCII -> musical glyphs --- */
function toMusical(str) {
  if (!str) return str;
  return String(str)
    .replace(/([A-Ga-g])##/g, '$1𝄪').replace(/([A-Ga-g])bb/g, '$1𝄫')
    .replace(/([A-Ga-g])#/g,  '$1♯').replace(/([A-Ga-g])b/g,  '$1♭')
    .replace(/##(?=\d)/g, '𝄪').replace(/bb(?=\d)/g, '𝄫')
    .replace(/#(?=\d)/g,  '♯').replace(/b(?=\d)/g,  '♭')
    .replace(/\bnat\s*(\d)/gi, '♮$1');
}

/* --- Minimal state (no UI for lists) --- */
function newList(name="", items=[], active=true) {
  return { id: (crypto.randomUUID ? crypto.randomUUID() : String(Math.random()).slice(2)), name, items, active };
}
const state = {
  lists: [
    newList("String", ["6","5","4","3","2","1"], true),
    newList("Note", ["A","A#/Bb","B","C","C#/Db","D","D#/Eb","E","F","F#/Gb","G","G#/Ab"], true)
  ]
};

/* --- Fit only the .fit line (single-line auto-shrink) --- */
function fitLines() {
  const out = $("out");
  const baseSize = parseFloat(getComputedStyle(out).fontSize) || 24; // px
  const minSize = 12; // px floor for readability

  out.querySelectorAll('.line.fit').forEach(line => {
    line.style.fontSize = ""; // reset
    const currentSize = parseFloat(getComputedStyle(line).fontSize) || baseSize;
    const maxWidth = out.clientWidth - 6; // small safety padding
    if (line.scrollWidth > maxWidth) {
      const ratio = maxWidth / line.scrollWidth;
      const newSize = Math.max(minSize, currentSize * ratio);
      line.style.fontSize = newSize + "px";
    }
  });
}

/* --- Picker --- */
function pick(){
  const active = state.lists.filter(l => l.active && l.items.length);
  if (!active.length) { $("out").textContent = "No active lists."; return; }

  let stringVal=null, noteVal=null;
  for (const l of active) {
    const v = l.items[Math.floor(Math.random()*l.items.length)];
    if ((l.name||"").toLowerCase()==="string") stringVal=v;
    else if ((l.name||"").toLowerCase()==="note") noteVal=v;
  }

  const s = EMBEDDED_SCALES[Math.floor(Math.random()*EMBEDDED_SCALES.length)];

  const nameStr = toMusical(s.name);
  const ivlStr  = toMusical(s.intervals);
  const noteStr = toMusical(noteVal);

  const html = [
    (stringVal || noteVal)
      ? `<div class="line fit">${
          [
            stringVal ? `<span class="label">String:</span> ${stringVal}` : null,
            noteVal   ? `<span class="label">Note:</span> ${noteStr}`     : null
          ].filter(Boolean).join(" · ")
        }</div>`
      : "",
    `<div class="line ellip"><span class="label">Scale:</span> ${nameStr} <span class="meta">(ID: ${s.id}, Size: ${s.size})</span></div>`,
    `<div class="line ellip"><span class="label">Intervals:</span> ${ivlStr}</div>`
  ].filter(Boolean).join("");

  $("out").innerHTML = html;
  fitLines();
}

/* --- Wire up --- */
$("pickBtn").addEventListener("click", pick);
document.addEventListener("keydown", e=>{
  if (e.code==="Space" && !/INPUT|TEXTAREA/.test(e.target.tagName)) { e.preventDefault(); pick(); }
});

/* Refit on resize / rotate (iOS Safari portrait/landscape) */
window.addEventListener("resize", fitLines);
window.addEventListener("orientationchange", () => setTimeout(fitLines, 50));
</script>
